package com.unia.y;

import java.io.IOException;
import java.io.OutputStream;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.Future;
/* loaded from: /mnt/shared/apks/menSe7ni.dex */
public class ap implements ad {

    /* renamed from: a  reason: collision with root package name */
    private static final int f482a = 5120;

    /* renamed from: g  reason: collision with root package name */
    private static ExecutorService f483g = Executors.newCachedThreadPool();
    private int b = f482a;
    private Map<String, Object> c = new HashMap();
    private List<ag> d = new ArrayList();
    private OutputStream e;
    private DatagramSocket f;
    private boolean h;
    private Future i;
    private String j;

    public ap(OutputStream outputStream, DatagramSocket datagramSocket) {
        this.e = outputStream;
        this.f = datagramSocket;
    }

    @Override // com.unia.y.ad
    public void a(int i) {
        this.b = i;
    }

    @Override // com.unia.y.ad
    public void a(ag agVar) {
        this.d.add(agVar);
    }

    @Override // com.unia.y.ad
    public void a(String str) {
        this.j = str;
    }

    @Override // com.unia.y.ad
    public void a(String str, Object obj) {
        this.c.put(str, obj);
    }

    @Override // com.unia.y.ad
    public boolean a() {
        if (this.h) {
            return false;
        }
        this.h = true;
        this.i = f483g.submit(new Runnable() { // from class: com.unia.y.ap.1
            @Override // java.lang.Runnable
            public void run() {
                int i = ap.this.b;
                byte[] bArr = new byte[i];
                while (ap.this.h) {
                    try {
                        DatagramPacket datagramPacket = new DatagramPacket(bArr, i);
                        ap.this.f.receive(datagramPacket);
                        am amVar = new am();
                        amVar.b(0);
                        amVar.c(0);
                        amVar.d(1);
                        amVar.a(datagramPacket.getAddress().getHostAddress());
                        amVar.e(datagramPacket.getPort());
                        amVar.a(Arrays.copyOf(datagramPacket.getData(), datagramPacket.getLength()));
                        byte[] b = amVar.b();
                        ap.this.e.write(b);
                        ap.this.e.flush();
                        for (ag agVar : ap.this.d) {
                            agVar.a(ap.this, b, b.length);
                        }
                    } catch (IOException unused) {
                        ap.this.h = false;
                    }
                }
            }
        });
        for (ag agVar : this.d) {
            agVar.a(this);
        }
        return true;
    }

    @Override // com.unia.y.ad
    public Object b(String str) {
        return this.c.get(str);
    }

    @Override // com.unia.y.ad
    public void b(ag agVar) {
        this.d.remove(agVar);
    }

    @Override // com.unia.y.ad
    public boolean b() {
        if (this.h) {
            this.h = false;
            Future future = this.i;
            if (future != null) {
                future.cancel(true);
            }
            f483g.shutdownNow();
            for (int i = 0; i < this.d.size(); i++) {
                this.d.get(i).b(this);
            }
            return true;
        }
        return false;
    }

    @Override // com.unia.y.ad
    public boolean c() {
        b();
        try {
            this.e.close();
            this.f.close();
            return true;
        } catch (IOException unused) {
            return false;
        }
    }

    @Override // com.unia.y.ad
    public int d() {
        return this.b;
    }

    @Override // com.unia.y.ad
    public boolean e() {
        return this.h;
    }

    @Override // com.unia.y.ad
    public String f() {
        return this.j;
    }

    @Override // com.unia.y.ad
    public Map<String, Object> g() {
        return this.c;
    }
}
