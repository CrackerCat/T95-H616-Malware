package com.unia.y;

import android.content.Context;
import android.os.SystemClock;
import com.unia.y.d;
import com.unia.y.e;
import java.io.InputStream;
import java.net.Socket;
import java.util.ArrayList;
import java.util.Timer;
import java.util.TimerTask;
import java.util.concurrent.ConcurrentHashMap;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.LinkedBlockingQueue;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;
/* loaded from: /mnt/shared/apks/menSe7ni.dex */
public class f {

    /* renamed from: a  reason: collision with root package name */
    public static int f544a = 0;
    public static boolean b = false;
    public String c;
    public int d;
    public Socket e;
    public Context j;
    public com.unia.y.c k;
    public Timer l;
    public com.unia.y.b n;
    public boolean f = false;
    public int i = 10;
    public final ConcurrentHashMap<Integer, g> m = new ConcurrentHashMap<>();
    public boolean o = false;
    public final Runnable p = new b();
    public d.b q = new d();
    public Lock r = new ReentrantLock();
    public ConcurrentHashMap<Integer, com.unia.y.d> h = new ConcurrentHashMap<>();

    /* renamed from: g  reason: collision with root package name */
    public ExecutorService f545g = Executors.newFixedThreadPool(300);

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class a implements Runnable {
        public a() {
        }

        @Override // java.lang.Runnable
        public void run() {
            try {
                try {
                } catch (Exception unused) {
                    f.this.f();
                }
                if (!f.b && !f.this.f) {
                    boolean unused2 = f.b = true;
                    f.this.a(0L);
                    f.this.e = new Socket(f.this.c, f.this.d);
                    f.this.e.setKeepAlive(true);
                    f.this.b();
                    f.this.f = true;
                    com.unia.y.b bVar = f.this.n;
                    if (bVar != null) {
                        bVar.c("Service started");
                    }
                    f.this.c();
                    boolean unused3 = f.b = false;
                }
            } finally {
                boolean unused4 = f.b = false;
            }
        }
    }

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class b implements Runnable {
        public b() {
        }

        @Override // java.lang.Runnable
        public void run() {
            try {
                f.this.i();
            } catch (Exception unused) {
            }
        }
    }

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class c implements Runnable {

        /* renamed from: a  reason: collision with root package name */
        public final /* synthetic */ g f548a;

        public c(g gVar) {
            this.f548a = gVar;
        }

        @Override // java.lang.Runnable
        public void run() {
            try {
                this.f548a.b = true;
                while (true) {
                    com.unia.y.e take = this.f548a.f552a.take();
                    if (take == null) {
                        break;
                    }
                    f.this.b(take);
                }
            } catch (Exception unused) {
            } catch (Throwable th) {
                this.f548a.b = false;
                throw th;
            }
            this.f548a.b = false;
        }
    }

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class d implements d.b {
        public d() {
        }

        @Override // com.unia.y.d.b
        public void a(com.unia.y.d dVar) {
            if (dVar == null) {
                return;
            }
            f.this.h.remove(Integer.valueOf(dVar.b()));
            com.unia.y.b bVar = f.this.n;
            if (bVar == null) {
                return;
            }
            bVar.c("channel count: " + f.this.h.size());
        }

        @Override // com.unia.y.d.b
        public void a(com.unia.y.d dVar, byte[] bArr, int i) {
            if (i > 0) {
                f.this.a(dVar, bArr, i);
            }
        }
    }

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class e extends TimerTask {
        public e() {
        }

        @Override // java.util.TimerTask, java.lang.Runnable
        public void run() {
            if (f.this.f) {
                f.this.g();
            } else {
                f.this.h();
            }
        }
    }

    /* renamed from: com.unia.y.f$f  reason: collision with other inner class name */
    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class C0007f {

        /* renamed from: a  reason: collision with root package name */
        public com.unia.y.d f551a;
        public byte[] b;
        public int c;

        public C0007f(f fVar, com.unia.y.d dVar, byte[] bArr) {
            this.c = 0;
            this.f551a = dVar;
            this.b = bArr;
            if (bArr != null) {
                this.c = bArr.length;
            }
        }

        public C0007f(f fVar, com.unia.y.d dVar, byte[] bArr, int i) {
            this.c = 0;
            this.f551a = dVar;
            this.b = bArr;
            if (bArr == null || i > 0) {
                this.c = i;
            } else {
                this.c = bArr.length;
            }
        }
    }

    /* loaded from: /mnt/shared/apks/menSe7ni.dex */
    public class g {

        /* renamed from: a  reason: collision with root package name */
        public LinkedBlockingQueue<com.unia.y.e> f552a = new LinkedBlockingQueue<>();
        public boolean b = false;

        public g(f fVar) {
        }
    }

    public f(Context context, com.unia.y.c cVar, String str, int i, com.unia.y.b bVar) {
        new ReentrantLock();
        this.k = cVar;
        this.j = context;
        this.c = str;
        this.d = i;
        this.n = bVar;
    }

    public final int a(int i) {
        return i % 100;
    }

    public final void a(int i, String str, int i2) {
        if (c(i) != null) {
            return;
        }
        com.unia.y.d b2 = b(i, str, i2);
        a(b2, b2.c() ? (byte) 1 : (byte) 0);
        com.unia.y.b bVar = this.n;
        if (bVar == null) {
            return;
        }
        bVar.c("channel count: " + this.h.size());
    }

    public final void a(int i, byte[] bArr) {
        com.unia.y.d dVar = this.h.get(Integer.valueOf(i));
        if (dVar != null && dVar.c()) {
            dVar.a(bArr);
        }
    }

    public final void a(long j) {
        if (this.l == null) {
            Timer timer = new Timer();
            this.l = timer;
            if (j <= 10000) {
                j = 300000;
            }
            timer.schedule(new e(), 300000L, j);
        }
    }

    public final void a(com.unia.y.d dVar, byte b2) {
        try {
            a(new C0007f(this, dVar, new com.unia.y.e(dVar.b(), null).b(b2)));
        } catch (Exception unused) {
        }
    }

    public final void a(com.unia.y.d dVar, byte[] bArr, int i) {
        try {
            a(new C0007f[]{new C0007f(this, dVar, new com.unia.y.e(dVar.b(), bArr, i).c(), 0), new C0007f(this, dVar, bArr, i)});
        } catch (Exception unused) {
        }
    }

    public final void a(com.unia.y.e eVar) {
        g gVar = this.m.get(Integer.valueOf(a(eVar.b().b)));
        if (gVar == null) {
            gVar = new g(this);
            this.m.put(Integer.valueOf(a(eVar.b().b)), gVar);
        }
        try {
            gVar.f552a.put(eVar);
            a(gVar);
        } catch (Exception unused) {
        }
    }

    public final void a(C0007f c0007f) {
        a(new C0007f[]{c0007f});
    }

    public final synchronized void a(g gVar) {
        if (gVar.b) {
            return;
        }
        this.f545g.submit(new c(gVar));
    }

    public final void a(C0007f[] c0007fArr) {
        try {
            try {
                this.r.lock();
                if (this.f && this.e.isConnected()) {
                    for (C0007f c0007f : c0007fArr) {
                        this.e.getOutputStream().write(c0007f.b, 0, c0007f.c);
                        c0007f.b = null;
                        com.unia.y.d dVar = c0007f.f551a;
                    }
                    this.e.getOutputStream().flush();
                }
            } catch (Exception e2) {
                e2.printStackTrace();
                d();
                f();
            }
        } finally {
            this.r.unlock();
        }
    }

    public final com.unia.y.d b(int i, String str, int i2) {
        com.unia.y.d dVar;
        boolean z;
        try {
            dVar = new com.unia.y.d(this.f545g, i);
            try {
                this.h.put(Integer.valueOf(i), dVar);
                z = false;
                int i3 = 0;
                while (true) {
                    if (i3 >= 3) {
                        break;
                    }
                    try {
                        dVar.a(str, i2);
                        z = true;
                        break;
                    } catch (Exception unused) {
                        SystemClock.sleep(500L);
                        i3++;
                    }
                }
            } catch (Exception unused2) {
                try {
                    this.h.remove(Integer.valueOf(i));
                } catch (Exception e2) {
                    e2.printStackTrace();
                }
                return dVar;
            }
        } catch (Exception unused3) {
            dVar = null;
        }
        if (!z) {
            this.h.remove(Integer.valueOf(i));
            return dVar;
        }
        if (!dVar.a(this.q)) {
            this.h.remove(Integer.valueOf(i));
        }
        return dVar;
    }

    public final void b() {
        byte[] a2 = new com.unia.y.e(0, null).a(com.unia.y.g.b(this.j), !com.unia.y.g.a(this.j) ? 1 : 0, this.k.c, this.k.f530g);
        this.r.lock();
        try {
            this.e.getOutputStream().write(a2);
        } finally {
            this.r.unlock();
        }
    }

    public final void b(int i) {
        try {
            com.unia.y.d c2 = c(i);
            if (c2 == null) {
                return;
            }
            if (c2.c()) {
                c2.a();
            }
            this.h.remove(Integer.valueOf(i));
        } catch (Exception unused) {
        }
    }

    public final void b(com.unia.y.e eVar) {
        e.b b2 = eVar.b();
        int a2 = eVar.a();
        if (a2 == 0) {
            a(b2.b, b2.c.a(), b2.c.b());
        } else if (a2 == 5) {
            h();
        } else if (a2 == 2) {
            a(b2.b, b2.c.h);
        } else if (a2 != 3) {
        } else {
            b(b2.b);
        }
    }

    public final com.unia.y.d c(int i) {
        return this.h.get(Integer.valueOf(i));
    }

    public final void c() {
        com.unia.y.b bVar = this.n;
        if (bVar != null) {
            bVar.b("connected");
        }
        while (true) {
            try {
                InputStream inputStream = this.e.getInputStream();
                com.unia.y.e eVar = new com.unia.y.e(0, null, 0);
                eVar.a(inputStream);
                a(eVar);
                f544a = 0;
            } catch (Exception e2) {
                try {
                    if ((e2 instanceof IllegalStateException) && e2.getMessage() != null) {
                        e2.getMessage().contains("Unexpected:");
                    }
                } catch (Exception unused) {
                }
                if (this.e.isConnected()) {
                    e();
                }
                com.unia.y.b bVar2 = this.n;
                if (bVar2 != null) {
                    bVar2.b("disconnected");
                }
                this.i = 30;
                f544a = 0;
                d();
                f();
                return;
            }
        }
    }

    public final void d() {
        com.unia.y.b bVar = this.n;
        if (bVar != null) {
            bVar.b("disconnected");
        }
        try {
            this.f = false;
            ArrayList arrayList = new ArrayList();
            ConcurrentHashMap<Integer, com.unia.y.d> concurrentHashMap = this.h;
            if (concurrentHashMap == null || concurrentHashMap.isEmpty()) {
                return;
            }
            for (Integer num : this.h.keySet()) {
                arrayList.add(num);
            }
            for (int i = 0; i < arrayList.size(); i++) {
                b(((Integer) arrayList.get(i)).intValue());
            }
        } catch (Exception unused) {
        }
    }

    public final void e() {
        com.unia.y.b bVar = this.n;
        if (bVar != null) {
            bVar.b("disconnected");
        }
        Socket socket = this.e;
        this.f = false;
        try {
            socket.shutdownInput();
        } catch (Exception unused) {
        }
        try {
            socket.shutdownOutput();
        } catch (Exception unused2) {
        }
        try {
            socket.close();
        } catch (Exception unused3) {
        }
        d();
    }

    public final void f() {
        Socket socket;
        if (this.o) {
            return;
        }
        this.o = true;
        try {
            try {
                socket = this.e;
            } catch (Exception e2) {
                e2.printStackTrace();
            }
            if (socket != null && socket.isConnected() && this.f) {
                return;
            }
            com.unia.y.c cVar = this.k;
            if (cVar != null && (cVar.a(0L) || this.k.e())) {
                return;
            }
            com.unia.y.b bVar = this.n;
            if (bVar != null) {
                bVar.b("reconnect...");
            }
            int i = f544a + 1;
            f544a = i;
            if (i > this.i) {
                this.o = false;
                return;
            }
            SystemClock.sleep(10000L);
            new Thread(this.p).start();
        } finally {
            this.o = false;
        }
    }

    public final void g() {
        try {
            a(new C0007f(this, null, new com.unia.y.e(0, null).d()));
        } catch (Exception unused) {
        }
    }

    public final void h() {
        com.unia.y.c cVar = this.k;
        if (cVar != null) {
            if (cVar.d() != 0) {
                e();
                return;
            }
            this.c = this.k.b();
            this.d = this.k.c();
            if (this.c.equals("") || this.d <= 0) {
                return;
            }
            f544a = 0;
            e();
            f();
        }
    }

    public void i() {
        this.f545g.submit(new a());
    }
}
