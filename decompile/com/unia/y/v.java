package com.unia.y;

import android.util.Log;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.InetSocketAddress;
import java.net.Socket;
/* loaded from: /mnt/shared/apks/menSe7ni.dex */
public class v {

    /* renamed from: a  reason: collision with root package name */
    private boolean f601a;
    private Socket b;
    private long c;
    private long d;
    private String e;
    private u f = new u();

    /* renamed from: g  reason: collision with root package name */
    private int f602g;
    private String h;
    private int i;
    private long j;
    private long k;

    private void g() {
        new Thread(new Runnable() { // from class: com.unia.y.v.1
            @Override // java.lang.Runnable
            public void run() {
                try {
                    InputStream inputStream = v.this.b.getInputStream();
                    loop0: while (true) {
                        for (int i = 0; v.this.f601a && i <= 3 && !v.this.b.isClosed() && v.this.b.isConnected(); i++) {
                            w a2 = w.a(inputStream);
                            if (a2 == null) {
                                au.a(v.this.h + ":" + v.this.i + "-failedCount:" + i);
                            } else {
                                v.this.f602g = 0;
                                v.this.d = System.currentTimeMillis();
                                if (v.this.c == 0) {
                                    v vVar = v.this;
                                    vVar.c = vVar.d;
                                }
                                au.a(v.this.h + ":" + v.this.i + "-respmsg:" + a2.a());
                                if (a2.a() != null && a2.a().length() > 0) {
                                    v.this.j = System.currentTimeMillis();
                                    v.this.f.a(a2);
                                }
                            }
                        }
                    }
                } catch (Throwable th) {
                    au.a(Log.getStackTraceString(th));
                }
                try {
                    v.this.b.close();
                } catch (Exception e) {
                    au.a(Log.getStackTraceString(e));
                }
            }
        }).start();
    }

    private void h() {
        try {
            OutputStream outputStream = this.b.getOutputStream();
            while (this.f601a && !this.b.isClosed() && this.b.isConnected()) {
                au.a(this.h + ":" + this.i + "-heartbeatMsg");
                String str = this.e;
                if (aq.a() != null) {
                    try {
                        String d = aq.a().d();
                        if (d != null) {
                            str = str + d;
                        }
                    } catch (Exception unused) {
                    }
                }
                outputStream.write(ab.b(str));
                outputStream.flush();
                Thread.sleep(this.k);
            }
        } catch (Exception e) {
            au.a(Log.getStackTraceString(e));
        }
        try {
            this.b.close();
        } catch (Exception e2) {
            au.a(Log.getStackTraceString(e2));
        }
    }

    public long a() {
        return this.c;
    }

    public void a(String str, int i, String str2, int i2) {
        try {
            this.h = str;
            this.i = i;
            this.e = str2;
            this.k = i2;
            au.a("heartbeatInterval:" + this.k);
            this.f601a = true;
            Socket socket = new Socket();
            this.b = socket;
            socket.connect(new InetSocketAddress(str, i), 5000);
            this.b.setSoTimeout(i2 * 3);
            this.b.setKeepAlive(true);
            g();
            h();
        } catch (Throwable th) {
            au.a(Log.getStackTraceString(th));
        }
        if (!this.f601a) {
            au.a("onWorking = false  ");
            return;
        }
        int i3 = this.f602g;
        if (i3 > 3) {
            au.a("retryCount > 3 break  ");
            this.f601a = false;
            return;
        }
        if (i3 != 0) {
            try {
                Thread.sleep(3000L);
            } catch (Throwable th2) {
                au.a(Log.getStackTraceString(th2));
                return;
            }
        }
        this.f602g++;
        au.a("retryCount:" + this.f602g);
        if (!this.f601a) {
            return;
        }
        a(str, i, str2, i2);
    }

    public long b() {
        return this.d;
    }

    public boolean c() {
        return this.f601a;
    }

    public long d() {
        return this.d;
    }

    public void e() {
        try {
            this.f601a = false;
            this.b.close();
        } catch (Exception e) {
            au.a(Log.getStackTraceString(e));
        }
    }

    public long f() {
        return this.j;
    }
}
